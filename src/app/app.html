<div class="service-dashboard">

  <!-- Compact Header -->
  <header class="dashboard-header">
    <div class="header-left">
      <img src="images/RMx.png" alt="RMx" class="logo">
      <div class="title-section">
        <h1>Service Dashboard</h1>
        <span class="subtitle">Real-time monitoring</span>
      </div>
    </div>
    <button class="refresh-btn" (click)="refreshAll()">
      <i class="fa fa-sync-alt"></i> Refresh
    </button>
  </header>

  <!-- Statistics Bar -->
  <section class="stats-bar">
    <div class="stat-item stat-total">
      <i class="fa fa-server"></i>
      <div class="stat-info">
        <span class="stat-number">{{ statistics.totalServices }}</span>
        <span class="stat-label">Total</span>
      </div>
    </div>
    <div class="stat-item stat-running">
      <i class="fa fa-check-circle"></i>
      <div class="stat-info">
        <span class="stat-number">{{ statistics.runningServices }}</span>
        <span class="stat-label">Running</span>
      </div>
    </div>
    <div class="stat-item stat-stopped">
      <i class="fa fa-stop-circle"></i>
      <div class="stat-info">
        <span class="stat-number">{{ statistics.stoppedServices }}</span>
        <span class="stat-label">Stopped</span>
      </div>
    </div>
    <div class="stat-item stat-warning">
      <i class="fa fa-exclamation-triangle"></i>
      <div class="stat-info">
        <span class="stat-number">{{ statistics.warningServices }}</span>
        <span class="stat-label">Warning</span>
      </div>
    </div>
  </section>

  <!-- Tabs + Search -->
  <nav class="tab-bar">
    <div class="tabs">
      <button
        class="tab"
        [class.active]="selectedTab === 'windows'"
        (click)="selectTab('windows')">
        <span class="tab-indicator" [class.error]="windowsServiceError"></span>
        <i class="fa fa-windows"></i>
        Windows Services
      </button>
      <button
        class="tab"
        [class.active]="selectedTab === 'tasks'"
        (click)="selectTab('tasks')">
        <span class="tab-indicator" [class.error]="taskSchedulerError"></span>
        <i class="fa fa-tasks"></i>
        Task Scheduler
      </button>
      <button
        class="tab"
        [class.active]="selectedTab === 'api'"
        (click)="selectTab('api')">
        <span class="tab-indicator" [class.error]="apiServiceError"></span>
        <i class="fa fa-plug"></i>
        API Services
      </button>
      <button
        class="tab"
        [class.active]="selectedTab === 'queue'"
        (click)="selectTab('queue')">
        <span class="tab-indicator" [class.error]="queueAlertError"></span>
        <i class="fa fa-list-alt"></i>
        Queue Alerts
      </button>
    </div>
    <div class="search-box">
      <i class="fa fa-search"></i>
      <input
        type="text"
        placeholder="Search..."
        [(ngModel)]="searchKey"
        autocomplete="off">
    </div>
  </nav>

  <!-- Content Area -->
  <main class="content">

    <!-- Windows Services -->
    <div *ngIf="selectedTab === 'windows'" class="tab-content">
      <div class="services-grid">
        <div class="service-card" *ngFor="let service of filteredWindowsServices">
          <div class="card-header">
            <div class="service-title">
              <i class="fa fa-cog"></i>
              <h3>{{ service.ServiceName }}</h3>
            </div>
            <span class="badge" [ngClass]="getStatusClass(service.Status)">
              {{ service.Status }}
            </span>
          </div>

          <div class="card-body">
            <p class="description">{{ service.Description }}</p>

            <div class="metrics">
              <div class="metric">
                <label>Server</label>
                <span>{{ service.ServerName }}</span>
              </div>
              <div class="metric">
                <label>Memory</label>
                <span>{{ service.MemoryUtilization }} MB</span>
              </div>
              <div class="metric">
                <label>Threads</label>
                <span>{{ service.ThreadCount }}</span>
              </div>
            </div>

            <div class="cpu-bars">
              <div class="cpu-bar-item">
                <label>Process CPU</label>
                <div class="progress-bar">
                  <div class="progress-fill"
                       [ngClass]="getCpuClass(service.CPUUtilization)"
                       [style.width.%]="service.CPUUtilization"></div>
                </div>
                <span class="percentage">{{ service.CPUUtilization }}%</span>
              </div>
              <div class="cpu-bar-item">
                <label>Total CPU</label>
                <div class="progress-bar">
                  <div class="progress-fill"
                       [ngClass]="getCpuClass(service.Total_CPU)"
                       [style.width.%]="service.Total_CPU"></div>
                </div>
                <span class="percentage">{{ service.Total_CPU }}%</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button
              class="btn btn-toggle"
              [class.btn-start]="service.Status !== 'Running'"
              [class.btn-stop]="service.Status === 'Running'"
              (click)="toggleWindowsService(service.ServiceName)">
              <i [class]="service.Status === 'Running' ? 'fa fa-stop' : 'fa fa-play'"></i>
              {{ service.Status === 'Running' ? 'Stop' : 'Start' }}
            </button>
            <button class="btn btn-logs" (click)="viewLogs(service.ServiceName, service.ServerName)">
              <i class="fa fa-file-text"></i> Logs
            </button>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="filteredWindowsServices.length === 0">
        <i class="fa fa-search"></i>
        <p>No services found</p>
      </div>
    </div>

    <!-- Task Scheduler -->
    <div *ngIf="selectedTab === 'tasks'" class="tab-content">
      <div class="services-grid">
        <div class="service-card" *ngFor="let task of filteredTaskSchedulers">
          <div class="card-header">
            <div class="service-title">
              <i class="fa fa-cogs"></i>
              <h3>{{ task.TaskName }}</h3>
            </div>
            <span class="badge" [ngClass]="getStatusClass(task.Status)">
              {{ task.Status }}
            </span>
          </div>

          <div class="card-body">
            <p class="description">{{ task.Description }}</p>
            <div class="metrics">
              <div class="metric">
                <label>Last Run</label>
                <span>{{ task.LastRunTime }}</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button
              class="btn btn-toggle"
              [class.btn-start]="task.Status !== 'Running'"
              [class.btn-stop]="task.Status === 'Running'"
              (click)="toggleTaskScheduler(task.TaskName)">
              <i [class]="task.Status === 'Running' ? 'fa fa-stop' : 'fa fa-play'"></i>
              {{ task.Status === 'Running' ? 'Stop' : 'Start' }}
            </button>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="filteredTaskSchedulers.length === 0">
        <i class="fa fa-search"></i>
        <p>No tasks found</p>
      </div>
    </div>

    <!-- API Services -->
    <div *ngIf="selectedTab === 'api'" class="tab-content">
      <div class="services-grid">
        <div class="service-card" *ngFor="let api of filteredApiServices">
          <div class="card-header">
            <div class="service-title">
              <i class="fa fa-plug"></i>
              <h3>{{ api.WebAPIName }}</h3>
            </div>
            <span class="badge" [ngClass]="getStatusClass(api.Status)">
              {{ api.Status }}
            </span>
          </div>

          <div class="card-body">
            <div class="metrics" *ngIf="api.Url">
              <div class="metric full-width">
                <label>URL</label>
                <span class="url">{{ api.Url }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="filteredApiServices.length === 0">
        <i class="fa fa-search"></i>
        <p>No API services found</p>
      </div>
    </div>

    <!-- Queue Alerts -->
    <div *ngIf="selectedTab === 'queue'" class="tab-content">
      <div class="queue-grid">
        <div class="queue-card" [ngClass]="getQueueColorClass(queue.Color)" *ngFor="let queue of filteredQueueAlerts">
          <div class="queue-header">
            <h3>{{ queue.QueueName }}</h3>
            <span class="queue-type">{{ queue.QueueType }}</span>
          </div>

          <div class="queue-body">
            <p class="description">{{ queue.QueueDesc }}</p>

            <div class="queue-info">
              <span><i class="fa fa-bullseye"></i> Threshold: {{ queue.Threshold }}</span>
              <span><i class="fa fa-clock"></i> Last: {{ queue.LastRun }}</span>
            </div>

            <div class="queue-metrics">
              <div class="queue-metric">
                <span class="value">{{ queue.LastHour }}</span>
                <span class="label">Last Hour</span>
              </div>
              <div class="queue-metric">
                <span class="value">{{ queue.New }}</span>
                <span class="label">New</span>
              </div>
              <div class="queue-metric">
                <span class="value">{{ queue.Inprocess }}</span>
                <span class="label">In Process</span>
              </div>
              <div class="queue-metric">
                <span class="value">{{ queue.Error }}</span>
                <span class="label">Error</span>
              </div>
              <div class="queue-metric">
                <span class="value">{{ queue.Completed }}</span>
                <span class="label">Completed</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="empty-state" *ngIf="filteredQueueAlerts.length === 0">
        <i class="fa fa-search"></i>
        <p>No queue alerts found</p>
      </div>
    </div>

  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <p>Processing...</p>
  </div>

</div>
