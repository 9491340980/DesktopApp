<div class="dashboard-container">

  <!-- Stats Overview -->
  <section class="stats-overview">
    <div class="stat-box stat-total">
      <div class="stat-icon"><i class="fa fa-server"></i></div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.totalServices }}</div>
        <div class="stat-label">Total Services</div>
      </div>
    </div>

    <div class="stat-box stat-running">
      <div class="stat-icon"><i class="fa fa-check-circle"></i></div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.runningServices }}</div>
        <div class="stat-label">Running</div>
        <div class="stat-percentage">{{ getPercentage(statistics.runningServices) }}%</div>
      </div>
    </div>

    <div class="stat-box stat-stopped">
      <div class="stat-icon"><i class="fa fa-times-circle"></i></div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.stoppedServices }}</div>
        <div class="stat-label">Stopped</div>
        <div class="stat-percentage">{{ getPercentage(statistics.stoppedServices) }}%</div>
      </div>
    </div>

    <div class="stat-box stat-warning">
      <div class="stat-icon"><i class="fa fa-exclamation-triangle"></i></div>
      <div class="stat-content">
        <div class="stat-value">{{ statistics.warningServices }}</div>
        <div class="stat-label">Issues</div>
        <div class="stat-percentage">{{ getPercentage(statistics.warningServices) }}%</div>
      </div>
    </div>
  </section>

  <!-- Control Bar with View Mode Toggle -->
  <section class="control-bar">
    <div class="tabs-section">
      <button class="tab-button"
              [class.active]="selectedTab === 'windows'"
              (click)="selectTab('windows')">
        <i class="fa fa-windows"></i>
        <span>Windows Services</span>
        <span class="badge" *ngIf="windowsServiceError">!</span>
      </button>

      <button class="tab-button"
              [class.active]="selectedTab === 'tasks'"
              (click)="selectTab('tasks')">
        <i class="fa fa-tasks"></i>
        <span>Task Scheduler</span>
        <span class="badge" *ngIf="taskSchedulerError">!</span>
      </button>

      <button class="tab-button"
              [class.active]="selectedTab === 'api'"
              (click)="selectTab('api')">
        <i class="fa fa-plug"></i>
        <span>API Services</span>
        <span class="badge" *ngIf="apiServiceError">!</span>
      </button>

      <button class="tab-button"
              [class.active]="selectedTab === 'queue'"
              (click)="selectTab('queue')">
        <i class="fa fa-list"></i>
        <span>Queue Alerts</span>
        <span class="badge" *ngIf="queueAlertError">!</span>
      </button>
    </div>

    <div class="filter-section">
      <!-- Search Input -->
      <div class="search-input">
        <i class="fa fa-search"></i>
        <input type="text"
               placeholder="Search services..."
               [(ngModel)]="searchKey"
               autocomplete="off">
        <span class="clear-btn" *ngIf="searchKey" (click)="searchKey = ''">×</span>
      </div>

      <!-- Status Filters -->
      <div class="status-filters">
        <button class="filter-btn"
                [class.active]="statusFilter === 'all'"
                (click)="statusFilter = 'all'">
          All
        </button>
        <button class="filter-btn filter-running"
                [class.active]="statusFilter === 'running'"
                (click)="statusFilter = 'running'">
          Running
        </button>
        <button class="filter-btn filter-stopped"
                [class.active]="statusFilter === 'stopped'"
                (click)="statusFilter = 'stopped'">
          Stopped
        </button>
      </div>

      <!-- ✅ NEW: View Mode Toggle (Moved from Top Nav!) -->
      <div class="view-mode-toggle">
        <button class="view-btn"
                [class.active]="viewMode === 'table'"
                (click)="setViewMode('table')"
                title="Table View">
          <i class="fa fa-table"></i>
        </button>
        <button class="view-btn"
                [class.active]="viewMode === 'cards'"
                (click)="setViewMode('cards')"
                title="Card View">
          <i class="fa fa-th-large"></i>
        </button>
      </div>
    </div>
  </section>

  <!-- Main Content Area -->
  <main class="main-content">

    <!-- TABLE VIEW - Windows Services -->
    <div class="content-section" *ngIf="selectedTab === 'windows' && viewMode === 'table'">
      <div class="table-container">
        <table class="services-table">
          <thead>
            <tr>
              <th class="col-status">Status</th>
              <th class="col-name">Service Name</th>
              <th class="col-description">Description</th>
              <th class="col-server">Server</th>
              <th class="col-cpu">CPU</th>
              <th class="col-memory">Memory</th>
              <th class="col-threads">Threads</th>
              <th class="col-actions">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let service of getFilteredServices()" [class.row-error]="service.Status !== 'Running'">
              <td class="col-status">
                <span class="status-indicator" [ngClass]="getStatusClass(service.Status)">
                  <i [class]="service.Status === 'Running' ? 'fa fa-check-circle' : 'fa fa-times-circle'"></i>
                  {{ service.Status }}
                </span>
              </td>
              <td class="col-name">
                <strong>{{ service.ServiceName }}</strong>
              </td>
              <td class="col-description">{{ service.Description }}</td>
              <td class="col-server">
                <span class="server-badge">{{ service.ServerName }}</span>
              </td>
              <td class="col-cpu">
                <div class="mini-progress">
                  <div class="mini-progress-bar"
                       [ngClass]="getCpuClass(service.CPUUtilization)"
                       [style.width.%]="service.CPUUtilization"></div>
                </div>
                <span class="mini-value">{{ service.CPUUtilization }}%</span>
              </td>
              <td class="col-memory">{{ service.MemoryUtilization }} MB</td>
              <td class="col-threads">{{ service.ThreadCount }}</td>
              <td class="col-actions">
                <button class="action-icon-btn"
                        [class.btn-stop]="service.Status === 'Running'"
                        [class.btn-start]="service.Status !== 'Running'"
                        (click)="toggleWindowsService(service.ServiceName)"
                        [title]="service.Status === 'Running' ? 'Stop Service' : 'Start Service'">
                  <i [class]="service.Status === 'Running' ? 'fa fa-stop' : 'fa fa-play'"></i>
                </button>
                <button class="action-icon-btn btn-logs"
                        (click)="viewLogs(service.ServiceName, service.ServerName)"
                        title="View Logs">
                  <i class="fa fa-file-text"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <div class="table-footer" *ngIf="getFilteredServices().length === 0">
          <div class="empty-message">
            <i class="fa fa-inbox"></i>
            <p>No services found</p>
          </div>
        </div>
      </div>
    </div>

    <!-- CARD VIEW - Windows Services -->
    <div class="content-section cards-view" *ngIf="selectedTab === 'windows' && viewMode === 'cards'">
      <div class="service-cards-grid">
        <div class="service-card" *ngFor="let service of getFilteredServices()">
          <div class="card-header">
            <div class="card-title">
              <i class="fa fa-cog"></i>
              <h3>{{ service.ServiceName }}</h3>
            </div>
            <span class="status-badge" [ngClass]="getStatusClass(service.Status)">
              {{ service.Status }}
            </span>
          </div>

          <div class="card-body">
            <p class="card-description">{{ service.Description }}</p>

            <div class="card-metrics">
              <div class="metric-item">
                <label>Server</label>
                <span>{{ service.ServerName }}</span>
              </div>
              <div class="metric-item">
                <label>Memory</label>
                <span>{{ service.MemoryUtilization }} MB</span>
              </div>
              <div class="metric-item">
                <label>Threads</label>
                <span>{{ service.ThreadCount }}</span>
              </div>
            </div>

            <div class="cpu-section">
              <div class="cpu-item">
                <label>Process CPU</label>
                <div class="progress-bar-wrapper">
                  <div class="progress-bar"
                       [ngClass]="getCpuClass(service.CPUUtilization)"
                       [style.width.%]="service.CPUUtilization"></div>
                </div>
                <span class="percentage">{{ service.CPUUtilization }}%</span>
              </div>
              <div class="cpu-item">
                <label>Total CPU</label>
                <div class="progress-bar-wrapper">
                  <div class="progress-bar"
                       [ngClass]="getCpuClass(service.Total_CPU)"
                       [style.width.%]="service.Total_CPU"></div>
                </div>
                <span class="percentage">{{ service.Total_CPU }}%</span>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button class="btn-action"
                    [class.btn-stop]="service.Status === 'Running'"
                    [class.btn-start]="service.Status !== 'Running'"
                    (click)="toggleWindowsService(service.ServiceName)">
              <i [class]="service.Status === 'Running' ? 'fa fa-stop' : 'fa fa-play'"></i>
              {{ service.Status === 'Running' ? 'Stop' : 'Start' }}
            </button>
            <button class="btn-action btn-logs" (click)="viewLogs(service.ServiceName, service.ServerName)">
              <i class="fa fa-file-text"></i> Logs
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Task Scheduler, API Services, Queue Alerts views... -->
    <!-- (Same as before, keeping for brevity) -->

  </main>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <div class="spinner"></div>
    <p>Processing...</p>
  </div>

</div>
