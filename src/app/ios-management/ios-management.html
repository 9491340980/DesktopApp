<div class="rmx-container">
  <div class="header">
    <h1>RMx Timeline Analysis</h1>
    <div class="actions">
      <input
        type="file"
        accept=".xlsx,.xls,.csv"
        (change)="onFileUpload($event)"
        #fileInput
        style="display: none"
      />
      <button mat-raised-button color="primary" (click)="fileInput.click()">
        <mat-icon>upload_file</mat-icon>
        Upload Excel
      </button>
      <button mat-raised-button (click)="exportAsPDF()">
        <mat-icon>picture_as_pdf</mat-icon>
        Export PDF
      </button>
      <button mat-raised-button (click)="exportAsJPG()">
        <mat-icon>image</mat-icon>
        Export JPG
      </button>
    </div>
  </div>

  <div #exportContainer class="export-container">
    <mat-card class="chart-card">
      <mat-card-content>
        <div class="canvas-wrapper">
          <canvas
            #chartCanvas
            (mousemove)="onCanvasMouseMove($event)"
            (mouseleave)="onCanvasMouseLeave()"
          ></canvas>
        </div>

        <div class="tooltip" *ngIf="showTooltip && hoveredPoint" [style.left.px]="tooltipX + 10" [style.top.px]="tooltipY - 80">
          <div class="tooltip-content">
            <div class="tooltip-title">{{ hoveredPoint.step }}</div>
            <div class="tooltip-row">
              <span class="tooltip-label">Time:</span>
              <span class="tooltip-value">{{ hoveredPoint.timestamp }}</span>
            </div>
            <div class="tooltip-row">
              <span class="tooltip-label">Duration:</span>
              <span class="tooltip-value">{{ hoveredPoint.duration.toFixed(3) }}s</span>
            </div>
            <div class="tooltip-row">
              <span class="tooltip-label">Cumulative:</span>
              <span class="tooltip-value">{{ hoveredPoint.y.toFixed(3) }}s</span>
            </div>
            <div class="tooltip-row" *ngIf="hoveredPoint.timeDifference !== undefined && hoveredPoint.timeDifference > 0">
              <span class="tooltip-label">Δ from previous:</span>
              <span class="tooltip-value difference">{{ hoveredPoint.timeDifference.toFixed(3) }}s</span>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <div class="statistics">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-label">Total Steps</div>
          <div class="stat-value">{{ totalSteps }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-label">Total Duration</div>
          <div class="stat-value">{{ totalDuration }}</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-label">Longest Step</div>
          <div class="stat-value">{{ longestStep }}</div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- <mat-card class="data-table">
      <mat-card-content>
        <h3>Process Steps Details</h3>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>Step</th>
                <th>Timestamp</th>
                <th>Duration (s)</th>
                <th>Cumulative (s)</th>
                <th>Δ Time (s)</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let point of chartPoints; let i = index" [class.highlight]="hoveredPoint?.x === point.x">
                <td>{{ i + 1 }}</td>
                <td class="step-name">{{ point.step }}</td>
                <td>{{ point.timestamp }}</td>
                <td>{{ point.duration.toFixed(3) }}</td>
                <td>{{ point.y.toFixed(3) }}</td>
                <td class="difference-cell">
                  <span *ngIf="point.timeDifference !== undefined && point.timeDifference > 0">
                    +{{ point.timeDifference.toFixed(3) }}
                  </span>
                  <span *ngIf="point.timeDifference === 0 || !point.timeDifference">-</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-card-content>
    </mat-card> -->
  </div>
</div>
