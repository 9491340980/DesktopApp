<div class="device-receiving-container">
  <!-- Left Sidebar - Device Detection -->
  <div class="sidebar-panel">
    <div class="sidebar-header">
      <div class="header-content">
        <mat-icon class="header-icon">devices</mat-icon>
        <span class="header-title">Detected Devices</span>
        <span class="device-badge" [class.has-devices]="connectedDevices.length > 0">
          {{ connectedDevices.length }}
        </span>
      </div>
      <button mat-icon-button (click)="refreshDevices()" class="refresh-button">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>

    <!-- Device List or Empty State -->
    <div class="sidebar-content">
      <div *ngIf="connectedDevices.length === 0" class="no-device-state">
        <div class="device-icon-container">
          <mat-icon class="device-icon-large">smartphone</mat-icon>
        </div>
        <h3 class="no-device-title">No Device Connected</h3>
        <p class="no-device-text">Connect device to begin</p>
      </div>

      <div *ngIf="connectedDevices.length > 0" class="device-list">
        <div *ngFor="let device of connectedDevices"
             class="device-item"
             [class.active]="selectedDevice === device"
             (click)="selectDevice(device)">
          <mat-icon class="device-item-icon">
            {{ device.isIPhone ? 'phone_iphone' : 'smartphone' }}
          </mat-icon>
          <div class="device-item-info">
            <span class="device-name">{{ getDeviceName(device) }}</span>
            <span class="device-type">{{ getDeviceTypeBadge(device) }}</span>
          </div>
          <mat-icon *ngIf="selectedDevice === device" class="check-icon">check_circle</mat-icon>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-panel">
    <!-- Center Card - Testing Form -->
    <div class="testing-card">
      <!-- Card Header -->
      <div class="card-header">
        <mat-icon class="card-icon">assignment</mat-icon>
        <h2 class="card-title">Apple Device Receiving / Label Printing</h2>
      </div>

      <!-- Card Body -->
      <div class="card-body">
        <!-- Status/Info Display (when device connected) -->
        <div *ngIf="selectedDevice && !isLookingUp" class="device-info-banner">
          <mat-icon class="info-icon">phone_iphone</mat-icon>
          <span class="info-text">Apple iPhone</span>
        </div>

        <!-- Looking Up State -->
        <div *ngIf="isLookingUp" class="lookup-state">
          <div class="lookup-content">
            <mat-spinner diameter="50" class="lookup-spinner"></mat-spinner>
            <h3 class="lookup-text">Looking up...</h3>
            <p class="lookup-subtext">Fetching device information</p>
          </div>
        </div>

        <!-- Error State -->
        <div *ngIf="lookupError" class="error-banner">
          <mat-icon class="error-icon">error</mat-icon>
          <p class="error-text">{{ lookupError }}</p>
        </div>

        <!-- Main Form -->
        <form [formGroup]="testForm" (ngSubmit)="submitTest()" class="testing-form">
          <!-- Manufacturer Serial Number - Large and prominent -->
          <div class="form-section">
            <label class="form-label">Manufacturer Serial Number</label>
            <mat-form-field appearance="outline" class="serial-field">
              <input matInput
                     formControlName="manufacturerSerial"
                     placeholder="Scan or enter serial number"
                     class="serial-input"
                     (blur)="onSerialEntered()"
                     [readonly]="isLookingUp">
              <!-- <mat-icon matSuffix class="input-icon">qr_code_scanner</mat-icon> -->
              <mat-error *ngIf="testForm.get('manufacturerSerial')?.hasError('required')">
                Serial number is required
              </mat-error>
            </mat-form-field>
          </div>

          <!-- MEID Field -->
          <div class="form-section">
            <label class="form-label">MEID</label>
            <mat-form-field appearance="outline" class="standard-field">
              <input matInput
                     formControlName="meid"
                     placeholder="Enter MEID"
                     >
              <!-- <mat-icon matSuffix class="input-icon">fingerprint</mat-icon> -->
            </mat-form-field>
          </div>
<div class="additional-options-section">
  <!-- Grade Selection -->
          <div class="form-section custom-grade-section">
            <label class="form-label">GRADE</label>
            <mat-form-field appearance="outline" class="grade-field" >
              <mat-select formControlName="grade" placeholder="Select grade" [attr.disabled]="true">
                <mat-option value="">Select Grade</mat-option>
                <mat-option value="A+">A+ (Excellent)</mat-option>
                <mat-option value="A">A (Very Good)</mat-option>
                <mat-option value="B+">B+ (Good)</mat-option>
                <mat-option value="B">B (Fair)</mat-option>
                <mat-option value="C">C (Poor)</mat-option>
                <mat-option value="D">D (Parts Only)</mat-option>
              </mat-select>
              <mat-error *ngIf="testForm.get('grade')?.hasError('required')">
                Grade is required
              </mat-error>
            </mat-form-field>
          </div>

        </div>
        <!-- Options Checkboxes -->
        <div class="form-section checkbox-section">
          <mat-checkbox formControlName="gsxCall" class="option-checkbox">
            <span class="checkbox-label">GsxCall</span>
          </mat-checkbox>
          <mat-checkbox formControlName="fmiCall" class="option-checkbox">
            <span class="checkbox-label">FMICall</span>
          </mat-checkbox>
          <mat-checkbox formControlName="autoPrintLabel" class="option-checkbox">
            <span class="checkbox-label">Auto-Print Label</span>
          </mat-checkbox>
        </div>
          

          <!-- Action Buttons -->
          <div class="action-section">
            <button mat-stroked-button
                    type="button"
                    (click)="resetForm()"
                    class="btn-cancel"
                    [disabled]="isSubmitting || isLookingUp">
              <mat-icon>close</mat-icon>
              <span>Cancel</span>
            </button>
            <button mat-raised-button
                    type="submit"
                    class="btn-submit"
                    [disabled]="!testForm.valid || isSubmitting || isLookingUp">
              <mat-spinner *ngIf="isSubmitting" diameter="20"></mat-spinner>
              <mat-icon *ngIf="!isSubmitting">print</mat-icon>
              <span>{{ isSubmitting ? 'Printing...' : 'Print Label / Print Again' }}</span>
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
