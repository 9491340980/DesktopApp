<div class="dashboard-container">



  <!-- Control Bar -->
  <section class="control-bar">
    <div class="search-filter-section">
      <!-- Search Input -->
      <mat-form-field class="search-field" appearance="outline">
        <mat-label>Search services...</mat-label>
        <input matInput [(ngModel)]="searchKey" placeholder="Search by name, description, or server"
          (input)="changeInput()">
        <mat-icon matPrefix>search</mat-icon>
        <button mat-icon-button matSuffix *ngIf="searchKey" (click)="searchKey = ''; changeInput()">
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <!-- Status Filter -->
      <!-- <mat-button-toggle-group [(ngModel)]="statusFilter" class="status-toggle">
        <mat-button-toggle value="all">All</mat-button-toggle>
        <mat-button-toggle value="running">Running</mat-button-toggle>
        <mat-button-toggle value="stopped">Stopped</mat-button-toggle>
      </mat-button-toggle-group> -->

      <!-- View Mode Toggle -->
      <!-- <mat-button-toggle-group [(ngModel)]="viewMode" class="view-toggle">
        <mat-button-toggle value="table" matTooltip="Table View">
          <mat-icon>table_chart</mat-icon>
        </mat-button-toggle>
        <mat-button-toggle value="cards" matTooltip="Card View">
          <mat-icon>view_module</mat-icon>
        </mat-button-toggle>
      </mat-button-toggle-group> -->

      <!-- Refresh Button -->
      <button mat-icon-button color="primary" (click)="refreshAll()" matTooltip="Refresh All">
        <mat-icon>refresh</mat-icon>
      </button>
    </div>
  </section>

  <!-- Main Tabs -->
  <mat-tab-group [(selectedIndex)]="selectedTab" (selectedIndexChange)="onTabChange($event)" class="main-tabs"
    animationDuration="300ms">

    <!-- Windows Services Tab -->
    <mat-tab *ngIf="!checkTabMatch(hideControls.controlProperties?.allowWindowsTab)">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon mr-2">computer</mat-icon>
        Windows Services
        <mat-chip *ngIf="serviceError" class="error-badge blink">!</mat-chip>
        <mat-chip *ngIf="!serviceError && services.length > 0" class="success-badge">✓</mat-chip>
      </ng-template>

      <!-- Table View -->
      <div class="tab-content" *ngIf="viewMode === 'table'">
        <!-- Statistics Overview Section -->
        <!-- <section class="stats-overview">
          <mat-card class="stat-card stat-total">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>dns</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ statistics.totalServices }}</div>
                <div class="stat-label">Total Services</div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card stat-running">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>check_circle</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ statistics.runningServices }}</div>
                <div class="stat-label">Running</div>
                <div class="stat-percentage">{{ getPercentage(statistics.runningServices) }}%</div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card stat-stopped">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>cancel</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ statistics.stoppedServices }}</div>
                <div class="stat-label">Stopped</div>
                <div class="stat-percentage">{{ getPercentage(statistics.stoppedServices) }}%</div>
              </div>
            </mat-card-content>
          </mat-card>

          <mat-card class="stat-card stat-warning">
            <mat-card-content>
              <div class="stat-icon">
                <mat-icon>warning</mat-icon>
              </div>
              <div class="stat-content">
                <div class="stat-value">{{ statistics.warningServices }}</div>
                <div class="stat-label">Issues</div>
                <div class="stat-percentage">{{ getPercentage(statistics.warningServices) }}%</div>
              </div>
            </mat-card-content>
          </mat-card>
        </section> -->
        <div class="table-container mat-elevation-z2">
          <table mat-table [dataSource]="getFilteredServices()" class="services-table">

            <!-- Service Name Column -->
            <ng-container matColumnDef="serviceName">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.windowsServices?.serviceLbl || 'Service Name' }}
              </th>
              <td mat-cell *matCellDef="let service">
                <div class="service-name-cell">
                  <mat-icon class="service-icon">settings</mat-icon>
                  <strong>{{ service.ServiceName }}</strong>
                </div>
              </td>
            </ng-container>



            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.windowsServices?.statusLbl || 'Status' }}
              </th>
              <td mat-cell *matCellDef="let service">
                <button mat-raised-button [color]="service.Status === commonEnum.Running ? 'success' : 'warn'"
                  [disabled]="!checkStatusAccessMatch(hideControls.controlProperties?.statusAccess, service.ServiceName) || isServiceLoading(service.ServiceName)"
                  (click)="startOrStop(service.ServiceName)" class="status-button">

                  <!-- Show spinner when loading -->
                  <mat-spinner *ngIf="isServiceLoading(service.ServiceName)" diameter="16"
                    style="display: inline-block; margin-right: 8px;">
                  </mat-spinner>

                  <!-- Show icon when not loading -->
                  <mat-icon *ngIf="!isServiceLoading(service.ServiceName)">
                    {{ service.Status === commonEnum.Running ? 'play_arrow' : 'stop' }}
                  </mat-icon>

                  <!-- Dynamic text -->
                  {{ getServiceButtonText(service) }}
                </button>
              </td>
            </ng-container>
            <!-- Server Name Column -->
            <ng-container matColumnDef="serverName">
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.serverName)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.serverNameLbl || 'Server Name' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.serverName)">
                <td mat-cell *matCellDef="let service">
                  <mat-chip class="server-chip">{{ service.ServerName }}</mat-chip>
                </td>
              </ng-container>
            </ng-container>

            <!-- Logs Column -->
            <ng-container matColumnDef="logs">
              <ng-container *ngIf="checkLogsMatch(hideControls.controlProperties?.logs)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.logsLbl || 'Logs' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkLogsMatch(hideControls.controlProperties?.logs)">
                <td mat-cell *matCellDef="let service">
                  <button mat-button color="blue" (click)="processConfirm(service.ServiceName, service.ServerName)">
                    <mat-icon>description</mat-icon>
                    View Logs
                  </button>
                </td>
              </ng-container>
            </ng-container>
            <!-- Description Column -->
            <ng-container matColumnDef="description">
              <ng-container *ngIf="checkDescriptionMatch(hideControls.controlProperties?.description)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.descriptionLbl || 'Description' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkDescriptionMatch(hideControls.controlProperties?.description)">
                <td mat-cell *matCellDef="let service">
                  {{ service.Description }}
                </td>
              </ng-container>
            </ng-container>

            <!-- Memory Utilization Column -->
            <ng-container matColumnDef="memoryUtilization">
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.memoryUtilization)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.memoryUtilizationLbl || 'Memory' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.memoryUtilization)">
                <td mat-cell *matCellDef="let service">
                  <span class="metric-value">{{ service.MemoryUtilization }} MB</span>
                </td>
              </ng-container>
            </ng-container>

            <!-- Thread Count Column -->
            <ng-container matColumnDef="threadCount">
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.ThreadCount)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.threadCountLbl || 'Threads' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.ThreadCount)">
                <td mat-cell *matCellDef="let service">
                  <span class="metric-value">{{ service.ThreadCount }}</span>
                </td>
              </ng-container>
            </ng-container>

            <!-- Process CPU Utilization Column -->
            <ng-container matColumnDef="processUtilization">
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.processUtilization)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.processUtilizationLbl || 'Process CPU' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.processUtilization)">
                <td mat-cell *matCellDef="let service">
                  <div class="cpu-progress">
                    <mat-progress-bar mode="determinate" [value]="service.CPUUtilization"
                      [ngClass]="getCpuClass(service.CPUUtilization)">
                    </mat-progress-bar>
                    <span class="cpu-value">{{ service.CPUUtilization }}%</span>
                  </div>
                </td>
              </ng-container>
            </ng-container>

            <!-- Total CPU Utilization Column -->
            <ng-container matColumnDef="cpuUtilization">
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.CpuUtilization)">
                <th mat-header-cell *matHeaderCellDef>
                  {{ hideControls.controlProperties?.windowsServices?.cpuUtilizationLbl || 'Total CPU' }}
                </th>
              </ng-container>
              <ng-container *ngIf="checkRolesMatch(hideControls.controlProperties?.CpuUtilization)">
                <td mat-cell *matCellDef="let service">
                  <div class="cpu-progress">
                    <mat-progress-bar mode="determinate" [value]="service.Total_CPU"
                      [ngClass]="getCpuClass(service.Total_CPU)">
                    </mat-progress-bar>
                    <span class="cpu-value">{{ service.Total_CPU }}%</span>
                  </div>
                </td>
              </ng-container>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
              [class.error-row]="row.Status !== commonEnum.Running"></tr>
          </table>

          <!-- Empty State -->
          <div class="empty-state" *ngIf="getFilteredServices().length === 0">
            <mat-icon>inbox</mat-icon>
            <p>No services found</p>
          </div>
        </div>
      </div>

      <!-- Card View -->
      <div class="tab-content cards-view" *ngIf="viewMode === 'cards'">
        <div class="cards-grid">
          <mat-card *ngFor="let service of getFilteredServices()" class="service-card"
            [class.error-card]="service.Status !== commonEnum.Running">
            <mat-card-header>
              <mat-icon mat-card-avatar>settings</mat-icon>
              <mat-card-title>{{ service.ServiceName }}</mat-card-title>
              <mat-card-subtitle>{{ service.Description }}</mat-card-subtitle>
            </mat-card-header>

            <mat-card-content>
              <div class="card-metrics">
                <div class="metric-row">
                  <span class="metric-label">Server:</span>
                  <mat-chip class="metric-chip">{{ service.ServerName }}</mat-chip>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Memory:</span>
                  <span class="metric-value">{{ service.MemoryUtilization }} MB</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Threads:</span>
                  <span class="metric-value">{{ service.ThreadCount }}</span>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Process CPU:</span>
                  <div class="cpu-progress">
                    <mat-progress-bar mode="determinate" [value]="service.CPUUtilization"
                      [ngClass]="getCpuClass(service.CPUUtilization)">
                    </mat-progress-bar>
                    <span class="cpu-value">{{ service.CPUUtilization }}%</span>
                  </div>
                </div>
                <div class="metric-row">
                  <span class="metric-label">Total CPU:</span>
                  <div class="cpu-progress">
                    <mat-progress-bar mode="determinate" [value]="service.Total_CPU"
                      [ngClass]="getCpuClass(service.Total_CPU)">
                    </mat-progress-bar>
                    <span class="cpu-value">{{ service.Total_CPU }}%</span>
                  </div>
                </div>
              </div>
            </mat-card-content>

            <mat-card-actions>
              <button mat-raised-button [color]="service.Status === commonEnum.Running ? 'primary' : 'warn'"
                [disabled]="!checkStatusAccessMatch(hideControls.controlProperties?.statusAccess, service.ServiceName) || isServiceLoading(service.ServiceName)"
                (click)="startOrStop(service.ServiceName)">

                <!-- Show spinner when loading -->
                <mat-spinner *ngIf="isServiceLoading(service.ServiceName)" diameter="16"
                  style="display: inline-block; margin-right: 8px;">
                </mat-spinner>

                <!-- Show icon when not loading -->
                <mat-icon *ngIf="!isServiceLoading(service.ServiceName)">
                  {{ service.Status === commonEnum.Running ? 'play_arrow' : 'stop' }}
                </mat-icon>

                <!-- Dynamic text -->
                {{ getServiceButtonText(service) }}
              </button>

              <button mat-button color="accent" (click)="processConfirm(service.ServiceName, service.ServerName)">
                <mat-icon>description</mat-icon>
                Logs
              </button>
            </mat-card-actions>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Task Scheduler Tab -->
    <mat-tab *ngIf="!checkTabMatch(hideControls.controlProperties?.allowTaskScheTab)">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">schedule</mat-icon>
        Task Scheduler
        <mat-chip *ngIf="serviceErrorTaskList" class="error-badge blink">!</mat-chip>
        <mat-chip *ngIf="!serviceErrorTaskList && tasks.length > 0" class="success-badge">✓</mat-chip>

      </ng-template>

      <div class="tab-content">
        <div class="table-container mat-elevation-z2">
          <table mat-table [dataSource]="getFilteredTasks()" class="services-table">

            <ng-container matColumnDef="taskName">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.taskScheduler?.taskNameLbl || 'Task Name' }}
              </th>
              <td mat-cell *matCellDef="let task">
                <div class="service-name-cell">
                  <mat-icon class="service-icon">schedule</mat-icon>
                  <strong>{{ task.TaskName }}</strong>
                </div>
              </td>
            </ng-container>

            <ng-container matColumnDef="description">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.taskScheduler?.desctiptionLbl || 'Description' }}
              </th>
              <td mat-cell *matCellDef="let task">{{ task.Description }}</td>
            </ng-container>

            <ng-container matColumnDef="lastRunTime">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.taskScheduler?.lastRunTimeLbl || 'Last Run Time' }}
              </th>
              <td mat-cell *matCellDef="let task">{{ task.LastRunTime }}</td>
            </ng-container>

            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>
                {{ hideControls.controlProperties?.taskScheduler?.statusLbl || 'Status' }}
              </th>
              <td mat-cell *matCellDef="let task">
                <button mat-raised-button [color]="task.Status === commonEnum.Running ? 'primary' : 'warn'"
                  [disabled]="isTaskLoading(task.TaskName)" (click)="startOrStopTask(task.TaskName)"
                  class="status-button">

                  <!-- Show spinner when loading -->
                  <mat-spinner *ngIf="isTaskLoading(task.TaskName)" diameter="16"
                    style="display: inline-block; margin-right: 8px;">
                  </mat-spinner>

                  <!-- Show icon when not loading -->
                  <mat-icon *ngIf="!isTaskLoading(task.TaskName)">
                    {{ task.Status === commonEnum.Running ? 'play_arrow' : 'stop' }}
                  </mat-icon>

                  <!-- Dynamic text -->
                  {{ getTaskButtonText(task) }}
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="['taskName', 'description', 'lastRunTime', 'status']"></tr>
            <tr mat-row *matRowDef="let row; columns: ['taskName', 'description', 'lastRunTime', 'status'];"
              [class.error-row]="row.Status !== commonEnum.Running"></tr>
          </table>

          <div class="empty-state" *ngIf="getFilteredTasks().length === 0">
            <mat-icon>inbox</mat-icon>
            <p>No tasks found</p>
          </div>
        </div>
      </div>
    </mat-tab>

    <!-- API Services Tab -->
    <mat-tab *ngIf="!checkTabMatch(hideControls.controlProperties?.allowApiTab)">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">api</mat-icon>
        API Services
        <mat-chip *ngIf="serviceErrorApilist" class="error-badge blink">!</mat-chip>
        <mat-chip *ngIf="!serviceErrorApilist && groupedApiServices.length > 0" class="success-badge">✓</mat-chip>

      </ng-template>

      <div class="tab-content">
        <div class="api-services-grid">
          <!-- Server Group Card -->
          <mat-card *ngFor="let serverGroup of groupedApiServices" class="server-group-card"
            [class.has-errors]="serverGroup.hasError">

            <!-- Server Header -->
            <mat-card-header class="server-header">
              <div class="server-header-content">
                <mat-icon class="server-icon">dns</mat-icon>
                <h3 class="server-name">{{ serverGroup.serverName }}</h3>
              </div>
            </mat-card-header>

            <mat-card-content class="services-list">
              <!-- API Service Row -->
              <div *ngFor="let service of serverGroup.services" class="service-row"
                [class.service-error]="service.status !== 'Running'">
                <div class="service-info">
                  <span class="service-name">{{ service.name }}</span>
                </div>
                <div class="service-status">
                  <mat-icon class="status-icon" [class.status-running]="service.status === 'Running'"
                    [class.status-error]="service.status !== 'Running'">
                    {{ service.status === 'Running' ? 'check_circle' : 'cancel' }}
                  </mat-icon>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="groupedApiServices.length === 0">
          <mat-icon>inbox</mat-icon>
          <p>No API services found</p>
        </div>
      </div>
    </mat-tab>

    <!-- Queue Alerts Tab -->
    <mat-tab *ngIf="checkTabMatch(hideControls.controlProperties?.allowQueueTab)">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">queue</mat-icon>
        Queue Alerts
        <mat-chip *ngIf="serviceErrorQueuelist" class="error-badge blink">!</mat-chip>
        <mat-chip *ngIf="!serviceErrorQueuelist && queService.length > 0" class="success-badge">✓</mat-chip>
      </ng-template>

      <div class="tab-content">
        <mat-tab-group class="nested-tabs">
          <!-- Queue Services Subtab -->
          <mat-tab *ngIf="checkTabMatch(hideControls.controlProperties?.allowQueueservicesTab)">
            <ng-template mat-tab-label>
              Queue Services
              <mat-chip *ngIf="serviceErrorDbAlertslist1" class="error-badge">!</mat-chip>
            </ng-template>

            <div class="queue-grid">
              <mat-card *ngFor="let queue of getFilteredQueueServices()" class="queue-card"
                [class.queue-error]="queue.Color !== commonEnum.GREEN">
                <mat-card-header>
                  <mat-icon mat-card-avatar>queue</mat-icon>
                  <mat-card-title>{{ queue.QueueName }}</mat-card-title>
                  <mat-card-subtitle>{{ queue.QueueDesc }}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="queue-metrics">
                    <div class="metric-item">
                      <span class="label">Last 15 Min:</span>
                      <mat-chip class="value">{{ queue.LastHour }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">New:</span>
                      <mat-chip class="value">{{ queue.New }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">In Process:</span>
                      <mat-chip class="value">{{ queue.Inprocess }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Error:</span>
                      <mat-chip class="value error">{{ queue.Error }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Completed:</span>
                      <mat-chip class="value success">{{ queue.Completed }}</mat-chip>
                    </div>
                    <div class="metric-item" *ngIf="checkRolesMatch(hideControls.controlProperties?.Threshold)">
                      <span class="label">Threshold:</span>
                      <mat-chip class="value">{{ queue.Threshold }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Last Run:</span>
                      <span class="value">{{ queue.LastRun }}</span>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </mat-tab>

          <!-- Queue Propagators Subtab -->
          <mat-tab *ngIf="checkTabMatch(hideControls.controlProperties?.allowQueuepropogatorsTab)">
            <ng-template mat-tab-label>
              Queue Propagators
              <mat-chip *ngIf="serviceErrorDbAlertslist" class="error-badge">!</mat-chip>
            </ng-template>

            <div class="queue-grid">
              <mat-card *ngFor="let queue of getFilteredQueuePropagators()" class="queue-card"
                [class.queue-error]="queue.Color !== commonEnum.GREEN">
                <mat-card-header>
                  <mat-icon mat-card-avatar>sync</mat-icon>
                  <mat-card-title>{{ queue.QueueName }}</mat-card-title>
                  <mat-card-subtitle>{{ queue.QueueDesc }}</mat-card-subtitle>
                </mat-card-header>
                <mat-card-content>
                  <div class="queue-metrics">
                    <div class="metric-item">
                      <span class="label">Last 15 Min:</span>
                      <mat-chip class="value">{{ queue.LastHour }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">New:</span>
                      <mat-chip class="value">{{ queue.New }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">In Process:</span>
                      <mat-chip class="value">{{ queue.Inprocess }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Error:</span>
                      <mat-chip class="value error">{{ queue.Error }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Completed:</span>
                      <mat-chip class="value success">{{ queue.Completed }}</mat-chip>
                    </div>
                    <div class="metric-item" *ngIf="checkRolesMatch(hideControls.controlProperties?.Threshold)">
                      <span class="label">Threshold:</span>
                      <mat-chip class="value">{{ queue.Threshold }}</mat-chip>
                    </div>
                    <div class="metric-item">
                      <span class="label">Last Run:</span>
                      <span class="value">{{ queue.LastRun }}</span>
                    </div>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </mat-tab>

    <!-- DB Jobs Tab -->
    <mat-tab *ngIf="checkTabMatch(hideControls.controlProperties?.dbJobs)">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">storage</mat-icon>
        DB Jobs
        <mat-chip *ngIf="dbJoblist" class="error-badge blink">!</mat-chip>
        <mat-chip *ngIf="!dbJoblist && dbJobsList.length > 0" class="success-badge">✓</mat-chip>
      </ng-template>

      <div class="tab-content">
        <!-- Schema Filter -->
        <div class="schema-filter">
          <mat-form-field appearance="outline">
            <mat-label>Select Schema</mat-label>
            <mat-select [(ngModel)]="selectedSchema" (selectionChange)="onSchima($event.value)">
              <mat-option *ngFor="let schema of schemaList" [value]="schema.Id">
                {{ schema.Text }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>

        <div class="table-container mat-elevation-z2">
          <table mat-table [dataSource]="dbJobsList" class="services-table">

            <!-- Id Column -->
            <ng-container matColumnDef="Id">
              <th mat-header-cell *matHeaderCellDef>Id</th>
              <td mat-cell *matCellDef="let job">{{ job.Id }}</td>
            </ng-container>

            <!-- Name Column -->
            <ng-container matColumnDef="Name">
              <th mat-header-cell *matHeaderCellDef>Name</th>
              <td mat-cell *matCellDef="let job">
                <div class="service-name-cell">
                  <strong>{{ job.Name }}</strong>
                </div>
              </td>
            </ng-container>

            <!-- Schema Column -->
            <ng-container matColumnDef="Schema">
              <th mat-header-cell *matHeaderCellDef>Schema</th>
              <td mat-cell *matCellDef="let job">{{ job.Schema }}</td>
            </ng-container>

            <!-- Broken Column -->
            <ng-container matColumnDef="Broken">
              <th mat-header-cell *matHeaderCellDef>Broken</th>
              <td mat-cell *matCellDef="let job">
                <mat-chip [color]="job.Broken === 'Y' ? 'warn' : 'primary'" selected>
                  {{ job.Broken }}
                </mat-chip>
              </td>
            </ng-container>

            <!-- Active Column -->
            <ng-container matColumnDef="Active">
              <th mat-header-cell *matHeaderCellDef>Active</th>
              <td mat-cell *matCellDef="let job">
                <mat-chip [color]="job.Active === 'Y' ? 'accent' : ''" selected>
                  {{ job.Active || 'N' }}
                </mat-chip>
              </td>
            </ng-container>

            <!-- LastRun Column -->
            <ng-container matColumnDef="LastRun">
              <th mat-header-cell *matHeaderCellDef>LastRun</th>
              <td mat-cell *matCellDef="let job">{{ job.LastRun }}</td>
            </ng-container>

            <!-- NextRun Column -->
            <ng-container matColumnDef="NextRun">
              <th mat-header-cell *matHeaderCellDef>NextRun</th>
              <td mat-cell *matCellDef="let job">{{ job.NextRun }}</td>
            </ng-container>

            <!-- Schedule Column -->
            <ng-container matColumnDef="Schedule">
              <th mat-header-cell *matHeaderCellDef>Schedule</th>
              <td mat-cell *matCellDef="let job">{{ job.Schedule }}</td>
            </ng-container>

            <!-- ClientId Column -->
            <ng-container matColumnDef="ClientId">
              <th mat-header-cell *matHeaderCellDef>ClientId</th>
              <td mat-cell *matCellDef="let job">{{ job.ClientId }}</td>
            </ng-container>

            <!-- SiteId Column -->
            <ng-container matColumnDef="SiteId">
              <th mat-header-cell *matHeaderCellDef>SiteId</th>
              <td mat-cell *matCellDef="let job">{{ job.SiteId }}</td>
            </ng-container>

            <!-- Failures Column -->
            <ng-container matColumnDef="Failures">
              <th mat-header-cell *matHeaderCellDef>Failures</th>
              <td mat-cell *matCellDef="let job">
                <mat-chip [color]="(job.Failures || 0) > 0 ? 'warn' : ''" selected>
                  {{ job.Failures || 0 }}
                </mat-chip>
              </td>
            </ng-container>

            <!-- Dynamic Header Row - Uses API field names -->
            <tr mat-header-row *matHeaderRowDef="dbJobsDisplayColumns"></tr>

            <!-- Dynamic Data Rows - Uses API field names -->
            <tr mat-row *matRowDef="let row; columns: dbJobsDisplayColumns;" [class.error-row]="row.Broken === 'Y'">
            </tr>
          </table>

          <div class="empty-state" *ngIf="dbJobsList.length === 0">
            <mat-icon>inbox</mat-icon>
            <p>No DB jobs found</p>
          </div>
        </div>
      </div>
    </mat-tab>

  </mat-tab-group>

  <!-- Loading Overlay -->
  <div class="loading-overlay" *ngIf="loading">
    <mat-spinner></mat-spinner>
    <p>Processing...</p>
  </div>

</div>
